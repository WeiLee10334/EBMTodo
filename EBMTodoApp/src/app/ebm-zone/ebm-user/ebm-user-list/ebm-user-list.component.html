<div class="container-fluid">
  <div class="row">
    <div class="col col-12">
      <span class="float-right">
        <label>每頁:</label>
        <select [(ngModel)]="QueryModel['Length']" (ngModelChange)="changeLength(QueryModel['Length'])">
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="50">50</option>
        </select>
      </span>
    </div>
  </div>
  <div class="row">
    <div class="table-responsive">
      <table class="table table-hover table-responsive-sm">
        <thead>
          <tr>
            <th>
              <button class="btn btn-info" (click)="refresh()">
                <i class="fa fa-repeat" aria-hidden="true"></i>
              </button>
            </th>
            <th *ngFor="let column of Columns" class="text-center">
              <span>{{column.name||column.prop}}&nbsp;
                <span *ngIf="column.orderby===undefined">
                  <i class="fa fa-sort" aria-hidden="true" (click)="changeOrderBy(column.prop,true)"></i>
                </span>
                <span *ngIf="column.orderby!==undefined" (click)="changeOrderBy(column.prop,!column.orderby)">
                  <i class="fa fa-sort-desc" *ngIf="!column.orderby" aria-hidden="true"></i>
                  <i class="fa fa-sort-asc" *ngIf="column.orderby" aria-hidden="true"></i>
                </span>
              </span>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>
              <button class="btn btn-success" (click)="add()">
                <i class="fa fa-plus" aria-hidden="true"></i>
              </button>
            </th>
            <th *ngFor="let column of Columns" class="text-center" [ngSwitch]="column.template">
              <span class="w-100" *ngSwitchCase="'date'">
                yyyy-MM-dd
              </span>
              <span *ngSwitchDefault>
                <input class="form-control" placeholder="search" (keyup)="updateFilters($event.target.value,column)">
              </span>
            </th>
          </tr>
        </tbody>
        <tbody>
          <ng-container *ngFor="let row of PagingData;let i = index;trackBy:trackByFn">
            <tr [ngClass]="{'table-active':getEditable(PagingData[i])}" app-user-table-row title="{{row.PID}}" [Editable]="getEditable(PagingData[i])||!PagingData[i]['Id']"
              [(ngModel)]="PagingData[i]">
              <td>
                <div class="btn-group" dropdown placement="bottom right" *ngIf="PagingData[i]['Id']&&!getEditable(PagingData[i])">
                  <button dropdownToggle type="button" class="btn btn-primary dropdownToggle">
                    <i class="fa fa-cog" aria-hidden="true"></i>
                  </button>
                  <ul *dropdownMenu class="dropdown-menu" role="menu">
                    <!-- <li role="menuitem">
                      <a class="btn btn-link dropdown-item" [routerLink]="['./working']" [queryParams]="{ Id:PagingData[i]['Id'],UserName:PagingData[i]['UserName'] }"
                        [routerLinkActive]="'active'">工作回報</a>
                    </li>
                    <li role="menuitem">
                      <a class="btn btn-link dropdown-item" [routerLink]="['./member']" [queryParams]="{ Id:PagingData[i]['Id'],UserName:PagingData[i]['UserName'] }"
                        [routerLinkActive]="'active'">專案角色</a>
                    </li> -->
                    <li role="menuitem">
                      <button class="btn btn-link dropdown-item" (click)="setEditable(PagingData[i])">修改</button>
                    </li>
                    <li role="menuitem">
                      <button class="btn btn-link dropdown-item" (click)="Delete(PagingData[i])">刪除</button>
                    </li>
                  </ul>
                </div>
                <button class="btn btn-success" *ngIf="getEditable(PagingData[i])" (click)="Save(PagingData[i])">儲存</button>
                <button class="btn btn-secondary" *ngIf="getEditable(PagingData[i])" (click)="Cancel(PagingData[i])">取消</button>
              </td>
            </tr>
          </ng-container>
        </tbody>
        <tfoot>
          <tr>
            <td [attr.colspan]="Columns.length+1">
              <div class="d-block mx-auto">
                <pagination [boundaryLinks]="true" [totalItems]="PagingInfo.TotalItems" [itemsPerPage]="QueryModel.Length" [(ngModel)]="PagingInfo.CurrentPage"
                  [maxSize]="PagingInfo.MaxSize" class="pagination-sm" previousText="&lsaquo;" nextText="&rsaquo;" firstText="&laquo;"
                  lastText="&raquo;" (pageChanged)="changePage($event)"></pagination>
              </div>
            </td>
          </tr>
      </table>
    </div>
  </div>
</div>